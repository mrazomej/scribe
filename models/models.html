

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SCRIBE Models for Single-Cell RNA Sequencing &mdash; SCRIBE  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SCRIBE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickoverview.html">Quick Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Available Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Available Models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../results.html">Results Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SCRIBE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">SCRIBE Models for Single-Cell RNA Sequencing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/models/models.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="scribe-models-for-single-cell-rna-sequencing">
<h1>SCRIBE Models for Single-Cell RNA Sequencing<a class="headerlink" href="#scribe-models-for-single-cell-rna-sequencing" title="Link to this heading"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">SCRIBE</span></code> provides a suite of probabilistic models designed to capture key
characteristics of single-cell RNA sequencing data. All models share a common
foundation but address different aspects of technical and biological variation.
This document explains the mathematical formulation, assumptions, and
implementation details of each model to help you select the most appropriate one
for your analysis.</p>
<section id="core-model-negative-binomial-dirichlet-multinomial-nbdm">
<h2>Core Model: Negative Binomial-Dirichlet Multinomial (NBDM)<a class="headerlink" href="#core-model-negative-binomial-dirichlet-multinomial-nbdm" title="Link to this heading"></a></h2>
<p>The NBDM model forms the foundation of <code class="docutils literal notranslate"><span class="pre">SCRIBE</span></code>’s approach, capturing three
essential aspects of scRNA-seq data:</p>
<ol class="arabic simple">
<li><p>The overdispersed nature of molecular counts</p></li>
<li><p>The compositional aspect of sequencing data</p></li>
<li><p>Gene-specific variation in expression levels</p></li>
</ol>
<p>Unlike standard scRNA-seq pipelines that use library-size normalization
(dividing by total UMI count, then log-transform), the NBDM model integrates
normalization into the generative process via the Dirichlet-multinomial. This
provides a more principled measure of uncertainty and helps separate technical
from biological variation.</p>
<section id="model-structure">
<h3>Model Structure<a class="headerlink" href="#model-structure" title="Link to this heading"></a></h3>
<p>The NBDM model follows a hierarchical structure where:</p>
<p>Each cell’s total molecular count follows a <a class="reference external" href="https://en.wikipedia.org/wiki/Negative_binomial_distribution">Negative Binomial distribution</a>. Given the
total count, the allocation of molecules across genes follows a
<a class="reference external" href="https://en.wikipedia.org/wiki/Dirichlet-multinomial_distribution">Dirichlet-Multinomial distribution</a>.</p>
<p>Formally, for a dataset with <span class="math notranslate nohighlight">\(N\)</span> cells and <span class="math notranslate nohighlight">\(G\)</span> genes, let
<span class="math notranslate nohighlight">\(u_{g}^{(c)}\)</span> be the UMI count for gene <span class="math notranslate nohighlight">\(g\)</span> in cell <span class="math notranslate nohighlight">\(c\)</span>, and
<span class="math notranslate nohighlight">\(U^{(c)} = \sum_{g=1}^G u_{g}^{(c)}\)</span> be the total UMI count for cell
<span class="math notranslate nohighlight">\(c\)</span>. The generative process is:</p>
<ol class="arabic simple">
<li><p>Draw global success probability: <span class="math notranslate nohighlight">\(p \sim \text{Beta}(\alpha_p, \beta_p)\)</span></p></li>
<li><p>Draw gene-specific dispersion parameters: <span class="math notranslate nohighlight">\(r_g \sim
\text{Gamma}(\alpha_r, \beta_r)\)</span> or <span class="math notranslate nohighlight">\(r_g \sim \text{LogNormal}(\mu_r,
\sigma_r)\)</span> for <span class="math notranslate nohighlight">\(g = 1,\ldots,G\)</span></p></li>
<li><p>For each cell <span class="math notranslate nohighlight">\(c = 1,\ldots,N\)</span>:</p>
<ul class="simple">
<li><p>Draw total count: <span class="math notranslate nohighlight">\(U^{(c)} \sim \text{NegativeBinomial}(\sum_g r_g, p)\)</span></p></li>
<li><p>Draw gene proportions: <span class="math notranslate nohighlight">\(u^{(c)} \sim \text{DirichletMultinomial}(r, U^{(c)})\)</span></p></li>
</ul>
</li>
</ol>
</section>
<section id="model-derivation">
<h3>Model Derivation<a class="headerlink" href="#model-derivation" title="Link to this heading"></a></h3>
<p>To derive the NBDM model, we start with the assumption that each gene’s mRNA
count in the cell follows a Negative Binomial distribution, i.e., for gene
<span class="math notranslate nohighlight">\(g\)</span>, the mRNA count <span class="math notranslate nohighlight">\(m_g\)</span> is of the form</p>
<div class="math notranslate nohighlight">
\[m_g \sim \text{NegativeBinomial}(r_g, p),
\tag{1}\]</div>
<p>where <span class="math notranslate nohighlight">\(r_g\)</span> is the gene-specific dispersion parameter and <span class="math notranslate nohighlight">\(p\)</span> is the
success probability <strong>shared across all genes</strong>. Assuming each mRNA count is
independent, the probability of observing an expression profile</p>
<div class="math notranslate nohighlight">
\[\underline{m} = (m_1, \ldots, m_G),
\tag{2}\]</div>
<p>where <span class="math notranslate nohighlight">\(G\)</span> is the total number of genes, is given by the product of the
individual probabilities, i.e.,</p>
<div class="math notranslate nohighlight">
\[\pi(\underline{m} \mid \underline{r}, p) =
\prod_{g=1}^G \text{NegativeBinomial}(m_g; r_g, p).
\tag{3}\]</div>
<p>Although one might question the assumption of a global success probability, this
assumption is less relevant in practice, as the negative binomial distribution
is a sloppy distribution, where changes in the success probability can be
compensated by changes in the dispersion parameter to obtain equivalent
numerically equivalent probability mass functions. In other words, the negative
binomial is a highly flexible distribution for which multiple parameter
combinations result in very similar probability mass functions.</p>
<p>Eq. (1) and (3) describe the probability of a cell having a given mRNA count.
However, experimentally, we do not directly observe the mRNA counts, but rather
UMI counts. To model the transformation from mRNA to UMI counts, we assume that
each mRNA molecule in the cell is captured with a probability <span class="math notranslate nohighlight">\(\nu\)</span>. This
implies that, conditioned on the mRNA count, the UMI count follows a binomial
distribution, i.e.,</p>
<div class="math notranslate nohighlight">
\[u_g \sim \text{Binomial}(m_g, \nu).
\tag{4}\]</div>
<p>where <span class="math notranslate nohighlight">\(\nu\)</span> is the capture efficiency shared across all genes and cells.
Nevertheless, since our observable only contains UMI counts, we must remove the
dependency on the mRNA count to obtain a model that is identifiable. To do so,
we can marginalize over the mRNA count, i.e.,</p>
<div class="math notranslate nohighlight">
\[\pi(u_g \mid r_g, p, \nu) = \sum_{m_g = u_g}^\infty \pi(m_g \mid r_g, p)
\pi(u_g \mid m_g, \nu).
\tag{5}\]</div>
<p>In words, Eq. (5) states that the probability of observing a UMI count
<span class="math notranslate nohighlight">\(u_g\)</span> for gene <span class="math notranslate nohighlight">\(g\)</span> is the sum of the probabilities of observing all
possible mRNA counts <span class="math notranslate nohighlight">\(m_g\)</span> that result in <span class="math notranslate nohighlight">\(u_g\)</span> UMIs. The sum in Eq.
(5) starts at <span class="math notranslate nohighlight">\(m_g = u_g\)</span> because, the cell cannot have more UMIs than the
number of mRNA molecules.</p>
<p>It can be shown that Eq. (5) results in a negative binomial distribution with a
re-scaled <span class="math notranslate nohighlight">\(p\)</span> parameter, i.e.,</p>
<div class="math notranslate nohighlight">
\[\pi(u_g \mid r_g, \hat{p}) = \text{NegativeBinomial}(u_g; r_g, \hat{p}),
\tag{6}\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{p} = \frac{p \nu}{1 - p(1 - \nu)}\)</span>. Thus, the joint
distribution of the UMI counts for all genes is given by</p>
<div class="math notranslate nohighlight">
\[\pi(\underline{u} \mid \underline{r}, \hat{p}) =
\prod_{g=1}^G \text{NegativeBinomial}(u_g; r_g, \hat{p}).
\tag{7}\]</div>
<p>Given these assumptions, we can show that the model in Eq. (7) can be expressed
in a much more compact form, where:</p>
<ol class="arabic simple">
<li><p>The total number of transcripts in the cell is drawn from a negative binomial</p></li>
</ol>
<div class="math notranslate nohighlight">
\[U \sim \text{NegativeBinomial}(R, p),
\tag{8}\]</div>
<p>where <span class="math notranslate nohighlight">\(U\)</span> is the total number of UMIs in the cell, and</p>
<div class="math notranslate nohighlight">
\[R = \sum_{g=1}^G r_g,
\tag{9}\]</div>
<p>is the sum of the dispersion parameters across all genes. Furthermore,</p>
<ol class="arabic simple" start="2">
<li><p>The total count <span class="math notranslate nohighlight">\(U\)</span> is then distributed across all genes via a
Dirichlet-multinomial distribution, i.e.,</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\underline{u} \mid U, \underline{r}, \sim
\text{DirichletMultinomial}(\underline{u}; U, \underline{r}),
\tag{10}\]</div>
<p>where <span class="math notranslate nohighlight">\(\underline{r} = (r_1, \ldots, r_G)\)</span> is the vector of dispersion
parameters across all genes.</p>
<p>The significance of this result is that in its derivation, we obtain a natural
normalization scheme for the UMI counts. More specifically, the
Dirichlet-multinomial from Eq. (10) is derived as</p>
<div class="math notranslate nohighlight">
\[\overbrace{
    \pi(\underline{u} \mid U, \underline{r})
 }^{\text{Dirichlet-multinomial}} =
 \int d^G\underline{\rho} \;
\overbrace{
    \pi(\underline{\rho} \mid U, \underline{r})
}^{\text{Dirichlet}} \;
\overbrace{
    \pi(\underline{u} \mid U, \underline{\rho})
}^{\text{multinomial}},
\tag{11}\]</div>
<p>where <span class="math notranslate nohighlight">\(\underline{\rho} = (\rho_1, \ldots, \rho_G)\)</span> is the vector of
proportions across all genes that satisfies</p>
<div class="math notranslate nohighlight">
\[\sum_{g=1}^G \rho_g = 1, \; \rho_g \geq 0 \; \forall \; g.
\tag{12}\]</div>
<p>The derivation above shows that once the total number of UMIs, <span class="math notranslate nohighlight">\(U\)</span>, is
drawn (via the negative binomial), the allocation of those UMIs across different
genes follows a Dirichlet-multinomial distribution. Intuitively, this means we
separate how many total UMIs a cell has from how those UMIs are split among its
genes. The Dirichlet-multinomial “naturally normalizes” the data because it lets
us talk about the fraction of the total transcriptome that each gene
constitutes, rather than just raw counts.</p>
<p>Concretely, if you know <span class="math notranslate nohighlight">\(U\)</span>, then you can think of a latent “proportion
vector” <span class="math notranslate nohighlight">\(\rho=(\rho_1,\ldots,\rho_G)\)</span>, describing what fraction of
<span class="math notranslate nohighlight">\(U\)</span> belongs to each gene. Instead of treating <span class="math notranslate nohighlight">\(\rho\)</span> as fixed, we
place a Dirichlet distribution on it with parameters <span class="math notranslate nohighlight">\(r=(r_1,\ldots,r_G)\)</span>.
These gene-specific parameters reflect how variable or overdispersed each gene’s
expression tends to be. When you integrate over all possible proportion vectors
<span class="math notranslate nohighlight">\(\rho\)</span>, you end up with a Dirichlet-multinomial distribution on the counts
<span class="math notranslate nohighlight">\(u\)</span>. In practice, once you infer the posterior distribution of the
<span class="math notranslate nohighlight">\(r\)</span> parameters from data, they become the “shape” parameters of the
Dirichlet, which in turn captures your uncertainty about each gene’s fraction of
the total transcriptome. This provides a principled, model-based way of
normalizing single-cell RNA-seq data by explicitly modeling both the total
number of UMIs and the gene-level fractions that compose it.</p>
</section>
</section>
<section id="zero-inflated-negative-binomial-model-zinb">
<h2>Zero-Inflated Negative Binomial Model (ZINB)<a class="headerlink" href="#zero-inflated-negative-binomial-model-zinb" title="Link to this heading"></a></h2>
<p>The Zero-Inflated Negative Binomial (ZINB) model extends the standard NBDM model
to handle excess zeros in single-cell RNA sequencing data. This model is
particularly useful when the data exhibits more zeros than would be expected
from a standard negative binomial distribution alone.</p>
<p>Like the NBDM model, the ZINB model captures overdispersion in molecular counts.
However, it differs in two key aspects:</p>
<ol class="arabic simple">
<li><p>It explicitly models technical dropouts via a <a class="reference external" href="https://en.wikipedia.org/wiki/Zero-inflated_model">zero-inflation component</a>.</p></li>
<li><p>It does not use the Dirichlet-multinomial in the likelihood, instead each
gene is fit independently to a zero-inflated negative binomial distribution.</p></li>
</ol>
<section id="model-comparison-with-nbdm">
<h3>Model Comparison with NBDM<a class="headerlink" href="#model-comparison-with-nbdm" title="Link to this heading"></a></h3>
<p>In the NBDM model, we focus on two key aspects:</p>
<ol class="arabic simple">
<li><p>How many total transcripts a cell has (drawn from a Negative Binomial)</p></li>
<li><p>How those transcripts are split among genes (captured by a Dirichlet-Multinomial)</p></li>
</ol>
<p>When normalizing single-cell data by focusing on fractions of the transcriptome,
the Dirichlet-multinomial machinery allows us to think of <span class="math notranslate nohighlight">\(\rho_g\)</span> as the
fraction of transcripts going to each gene <span class="math notranslate nohighlight">\(g\)</span>.</p>
<p>The Zero-Inflated Negative Binomial (ZINB) model adds an extra “dropout” or
“technical zero” component to account for unobserved transcripts. If these extra
zeros are purely technical—i.e., they do not change the true underlying fraction
of transcripts that each gene contributes but are instead due to technical
limitations when mapping mRNA molecules to UMI counts—then it’s valid to ignore
the zero-inflation part, allowing us to use the same <span class="math notranslate nohighlight">\(\rho_g\)</span> parameters
for fraction-based normalization. The model has two key components:</p>
<ol class="arabic simple">
<li><p><strong>Dropout probability (Technical Zeros)</strong>: Some fraction of transcripts is
“lost” and recorded as zero for purely technical reasons.</p></li>
<li><p><strong>Underlying Gene Counts</strong>: Conditioned on not being dropped out, the gene’s
counts still follow a Negative Binomial with parameters <span class="math notranslate nohighlight">\(r_g\)</span> and
<span class="math notranslate nohighlight">\(p\)</span>.</p></li>
</ol>
<p>If you strip away the dropout events, the core distribution for each gene’s true
expression is the same <a class="reference external" href="https://en.wikipedia.org/wiki/Negative_binomial_distribution">Negative Binomial</a> as before.
Consequently, you can still think of <span class="math notranslate nohighlight">\(\underline{r} = \{r_g\}_{g=1}^G\)</span> as
capturing the gene-specific overdispersion for the “real” expression levels,
just like in the NBDM model.</p>
<p>From a normalization perspective, the key question becomes: “<em>Among all the
transcripts that would have been observed if there were no technical dropouts,
what fraction goes to each gene?</em>” If dropout is treated as a purely technical
artifact that does not alter the underlying composition, then that fraction is
governed by the same <span class="math notranslate nohighlight">\(\underline{r}\)</span> parameters. In other words, the
dropout layer is separate—it explains missing observations rather than
redefining the overall fraction each gene represents in the cell.</p>
</section>
<section id="id1">
<h3>Model Structure<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>The ZINB model follows a hierarchical structure where:</p>
<ol class="arabic simple">
<li><p>Each gene has an associated dropout probability (<cite>gate</cite>)</p></li>
<li><p>For genes that aren’t dropped out, counts follow a negative binomial distribution</p></li>
<li><p>The model handles each gene independently, with shared success probability across genes</p></li>
</ol>
<p>Formally, for a dataset with <span class="math notranslate nohighlight">\(N\)</span> cells and <span class="math notranslate nohighlight">\(G\)</span> genes, let
<span class="math notranslate nohighlight">\(u_{g}^{(c)}\)</span> be the UMI count for gene <span class="math notranslate nohighlight">\(g\)</span> in cell <span class="math notranslate nohighlight">\(c\)</span>. The
generative process is:</p>
<ol class="arabic simple">
<li><p>Draw global success probability: <span class="math notranslate nohighlight">\(p \sim \text{Beta}(\alpha_p, \beta_p)\)</span></p></li>
<li><p>For each gene <span class="math notranslate nohighlight">\(g = 1,\ldots,G\)</span>:</p>
<ul class="simple">
<li><p>Draw dispersion parameter: <span class="math notranslate nohighlight">\(r_g \sim \text{Gamma}(\alpha_r, \beta_r)\)</span>
or <span class="math notranslate nohighlight">\(r_g \sim \text{LogNormal}(\mu_r, \sigma_r)\)</span></p></li>
<li><p>Draw dropout probability: <span class="math notranslate nohighlight">\(\pi_g \sim \text{Beta}(\alpha_{\pi}, \beta_{\pi})\)</span></p></li>
</ul>
</li>
<li><p>For each cell <span class="math notranslate nohighlight">\(c = 1,\ldots,N\)</span> and gene <span class="math notranslate nohighlight">\(g = 1,\ldots,G\)</span>:</p>
<ul class="simple">
<li><p>Draw dropout indicator: <span class="math notranslate nohighlight">\(z_g^{(c)} \sim \text{Bernoulli}(\pi_g)\)</span></p></li>
<li><p>If <span class="math notranslate nohighlight">\(z_g^{(c)} = 1\)</span>: set <span class="math notranslate nohighlight">\(u_g^{(c)} = 0\)</span></p></li>
<li><p>If <span class="math notranslate nohighlight">\(z_g^{(c)} = 0\)</span>: draw <span class="math notranslate nohighlight">\(u_g^{(c)} \sim \text{NegativeBinomial}(r_g, p)\)</span></p></li>
</ul>
</li>
</ol>
</section>
<section id="id2">
<h3>Model Derivation<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>The ZINB model combines a Bernoulli distribution for dropout events with a
negative binomial for the actual counts. For each gene <span class="math notranslate nohighlight">\(g\)</span> and cell
<span class="math notranslate nohighlight">\(c\)</span>, the probability of observing a count <span class="math notranslate nohighlight">\(u_g^{(c)}\)</span> is:</p>
<div class="math notranslate nohighlight">
\[\pi(u_g^{(c)} \mid \pi_g, r_g, p) =
\pi_g \delta_{0}(u_g^{(c)}) + (1-\pi_g)
\text{NegativeBinomial}(u_g^{(c)}; r_g, p),
\tag{13}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\pi_g\)</span> is the dropout probability for gene <span class="math notranslate nohighlight">\(g\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\delta_{0}(x)\)</span> is the Dirac delta function at zero</p></li>
<li><p><span class="math notranslate nohighlight">\(r_g\)</span> is the gene-specific dispersion parameter</p></li>
<li><p><span class="math notranslate nohighlight">\(p\)</span> is the shared success probability</p></li>
</ul>
<p>Unlike the NBDM model, each gene is fit to an independent zero-inflated negative
binomial. The joint probability across all genes and cells is simply:</p>
<div class="math notranslate nohighlight">
\[\pi(\underline{\underline{U}} \mid \underline{\pi}, \underline{r}, p) =
\prod_{c=1}^N \prod_{g=1}^G \pi_g \delta_{0}(u_g^{(c)}) + (1-\pi_g)
\text{NegativeBinomial}(u_g^{(c)}; r_g, p)
\tag{14}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\underline{\underline{U}}\)</span> is the complete count matrix</p></li>
<li><p><span class="math notranslate nohighlight">\(\underline{\pi}\)</span> is the vector of dropout probabilities</p></li>
<li><p><span class="math notranslate nohighlight">\(\underline{r}\)</span> is the vector of dispersion parameters</p></li>
</ul>
</section>
</section>
<section id="negative-binomial-with-variable-capture-probability-model-nbvcp">
<h2>Negative Binomial with Variable Capture Probability Model (NBVCP)<a class="headerlink" href="#negative-binomial-with-variable-capture-probability-model-nbvcp" title="Link to this heading"></a></h2>
<p>The Negative Binomial with Variable Capture Probability (NBVCP) model extends
the NBDM model by explicitly modeling cell-specific capture efficiencies. This
model is particularly useful when cells exhibit significant variation in their
total UMI counts, which may indicate differences in mRNA capture rates rather
than true biological differences in expression.</p>
<p>Like the NBDM model, the NBVCP model captures overdispersion in molecular
counts. However, it differs in two key aspects:</p>
<ol class="arabic simple">
<li><p>It explicitly models cell-specific capture probabilities that modify the
success probability of the negative binomial</p></li>
<li><p>It does not use the Dirichlet-multinomial in the likelihood, instead treating
each gene independently</p></li>
</ol>
<section id="id3">
<h3>Model Comparison with NBDM<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p>In the NBDM model, we assume a single success probability <span class="math notranslate nohighlight">\(p\)</span> that is
shared across all cells. The NBVCP model relaxes this assumption by introducing
cell-specific capture probabilities that modify how the base success probability
manifests in each cell.</p>
<p>The key insight is that variations in capture efficiency can make the same
underlying mRNA abundance appear different in the UMI counts. The NBVCP model
handles this by:</p>
<ol class="arabic simple">
<li><p>Maintaining a base success probability <span class="math notranslate nohighlight">\(p\)</span> that represents the “true”
biological probability</p></li>
<li><p>Introducing cell-specific capture probabilities <span class="math notranslate nohighlight">\(\nu^{(c)}\)</span> that modify
this base probability</p></li>
<li><p>Computing an effective success probability for each cell <span class="math notranslate nohighlight">\(c\)</span> as:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\hat{p}^{(c)} = \frac{p \nu^{(c)}}{1 - p (1 - \nu^{(c)})}
\tag{15}\]</div>
<p>This adjusted probability accounts for how the capture efficiency of each cell
affects our ability to observe its true mRNA content.</p>
<p>Given the explicit modeling of the cell-specific capture probabilities, the
NBVCP model can remove technical variability, allowing for the same
normalization methods as the NBDM model based on the Dirichlet-Multinomial
model. In other words, since the NBVCP model fits a parameter to account for
significant technical variations in the total number of counts per cell, once
this effect is removed, the remaining variation can be modeled using the same
<span class="math notranslate nohighlight">\(\underline{r}\)</span> parameters as the NBDM model. Thus, the NBVCP model
presents a more principled approach to normalization compared to other methods
in the scRNA-seq literature.</p>
</section>
<section id="id4">
<h3>Model Structure<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>The NBVCP model follows a hierarchical structure where:</p>
<ol class="arabic simple">
<li><p>Each cell has an associated capture probability <span class="math notranslate nohighlight">\(\nu^{(c)}\)</span></p></li>
<li><p>The base success probability <span class="math notranslate nohighlight">\(p\)</span> is modified by each cell’s capture
probability to give an effective success probability <span class="math notranslate nohighlight">\(\hat{p}^{(c)}\)</span></p></li>
<li><p>Gene counts follow independent negative binomial distributions with
cell-specific effective probabilities</p></li>
</ol>
<p>Formally, for a dataset with <span class="math notranslate nohighlight">\(N\)</span> cells and <span class="math notranslate nohighlight">\(G\)</span> genes, let
<span class="math notranslate nohighlight">\(u_{g}^{(c)}\)</span> be the UMI count for gene <span class="math notranslate nohighlight">\(g\)</span> in cell <span class="math notranslate nohighlight">\(c\)</span>. The
generative process is:</p>
<ol class="arabic simple">
<li><p>Draw global success probability: <span class="math notranslate nohighlight">\(p \sim \text{Beta}(\alpha_p, \beta_p)\)</span></p></li>
<li><p>Draw gene-specific dispersion parameters: <span class="math notranslate nohighlight">\(r_g \sim
\text{Gamma}(\alpha_r, \beta_r)\)</span> or <span class="math notranslate nohighlight">\(r_g \sim \text{LogNormal}(\mu_r,
\sigma_r)\)</span> for <span class="math notranslate nohighlight">\(g = 1,\ldots,G\)</span></p></li>
<li><p>For each cell <span class="math notranslate nohighlight">\(c = 1,\ldots,N\)</span>:</p>
<ul class="simple">
<li><p>Draw capture probability: <span class="math notranslate nohighlight">\(\nu^{(c)} \sim \text{Beta}(\alpha_{\nu}, \beta_{\nu})\)</span></p></li>
<li><p>Compute effective probability: <span class="math notranslate nohighlight">\(\hat{p}^{(c)} = \frac{p \nu^{(c)}}{1 - p (1 - \nu^{(c)})}\)</span></p></li>
<li><p>For each gene <span class="math notranslate nohighlight">\(g = 1,\ldots,G\)</span>: - Draw count: <span class="math notranslate nohighlight">\(u_g^{(c)} \sim \text{NegativeBinomial}(r_g, \hat{p}^{(c)})\)</span></p></li>
</ul>
</li>
</ol>
</section>
<section id="id5">
<h3>Model Derivation<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p>The NBVCP model can be derived by considering how the mRNA capture efficiency
affects the observed UMI counts. Starting with the standard negative binomial
model for mRNA counts:</p>
<div class="math notranslate nohighlight">
\[m_g^{(c)} \sim \text{NegativeBinomial}(r_g, p),
\tag{16}\]</div>
<p>where <span class="math notranslate nohighlight">\(m_g^{(c)}\)</span> is the unobserved mRNA count for gene <span class="math notranslate nohighlight">\(g\)</span> in cell
<span class="math notranslate nohighlight">\(c\)</span>, <span class="math notranslate nohighlight">\(r_g\)</span> is the dispersion parameter, and <span class="math notranslate nohighlight">\(p\)</span> is the base
success probability shared across all cells. We then model the capture process
as a binomial sampling where each mRNA molecule has probability
<span class="math notranslate nohighlight">\(\nu^{(c)}\)</span> of being captured:</p>
<div class="math notranslate nohighlight">
\[u_g^{(c)} \mid m_g^{(c)} \sim \text{Binomial}(m_g^{(c)}, \nu^{(c)})
\tag{17}\]</div>
<p>Marginalizing over the unobserved mRNA counts <span class="math notranslate nohighlight">\(m_g^{(c)}\)</span>, we get:</p>
<div class="math notranslate nohighlight">
\[u_g^{(c)} \sim \text{NegativeBinomial}(r_g, \hat{p}^{(c)})
\tag{18}\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{p}^{(c)}\)</span> is the effective probability defined in Eq. (15).</p>
</section>
</section>
<section id="zero-inflated-negative-binomial-with-variable-capture-probability-model-zinbvcp">
<h2>Zero-Inflated Negative Binomial with Variable Capture Probability Model (ZINBVCP)<a class="headerlink" href="#zero-inflated-negative-binomial-with-variable-capture-probability-model-zinbvcp" title="Link to this heading"></a></h2>
<p>The Zero-Inflated Negative Binomial with Variable Capture Probability (ZINBVCP)
model combines aspects of both the ZINB and NBVCP models to handle both
technical dropouts and variable capture efficiencies in single-cell RNA
sequencing data. This model is particularly useful when the data exhibits both
excess zeros and significant variation in total UMI counts across cells.</p>
<p>The ZINBVCP model incorporates two key features:</p>
<ol class="arabic simple">
<li><p>Zero-inflation to model technical dropouts (from ZINB)</p></li>
<li><p>Cell-specific capture probabilities (from NBVCP)</p></li>
</ol>
<section id="model-comparison-with-nbvcp-and-zinb">
<h3>Model Comparison with NBVCP and ZINB<a class="headerlink" href="#model-comparison-with-nbvcp-and-zinb" title="Link to this heading"></a></h3>
<p>The ZINBVCP model extends both the NBVCP and ZINB models by combining their key
features. From the NBVCP model, it inherits the cell-specific capture
probabilities <span class="math notranslate nohighlight">\(\nu^{(c)}\)</span> that modify the base success probability
<span class="math notranslate nohighlight">\(p\)</span>. From the ZINB model, it inherits the gene-specific dropout
probabilities <span class="math notranslate nohighlight">\(\pi_g\)</span> that model technical zeros.</p>
<p>The effective success probability for each cell <span class="math notranslate nohighlight">\(c\)</span> is computed as shown
in Eq. (15). This is then combined with the dropout mechanism to give a
zero-inflated distribution where the non-zero counts use the cell-specific
effective probability.</p>
</section>
<section id="id6">
<h3>Model Structure<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<p>The ZINBVCP model follows a hierarchical structure where:</p>
<ol class="arabic simple">
<li><p>Each gene has an associated dropout probability <span class="math notranslate nohighlight">\(\pi_g\)</span></p></li>
<li><p>Each cell has an associated capture probability <span class="math notranslate nohighlight">\(\nu^{(c)}\)</span></p></li>
<li><p>The base success probability <span class="math notranslate nohighlight">\(p\)</span> is modified by each cell’s capture probability</p></li>
<li><p>For genes that aren’t dropped out, counts follow a negative binomial with cell-specific effective probabilities</p></li>
</ol>
<p>Formally, for a dataset with <span class="math notranslate nohighlight">\(N\)</span> cells and <span class="math notranslate nohighlight">\(G\)</span> genes, let
<span class="math notranslate nohighlight">\(u_{g}^{(c)}\)</span> be the UMI count for gene <span class="math notranslate nohighlight">\(g\)</span> in cell <span class="math notranslate nohighlight">\(c\)</span>. The
generative process is:</p>
<ol class="arabic">
<li><p>Draw global success probability: <span class="math notranslate nohighlight">\(p \sim \text{Beta}(\alpha_p, \beta_p)\)</span></p></li>
<li><p>For each gene <span class="math notranslate nohighlight">\(g = 1,\ldots,G\)</span>:</p>
<ul class="simple">
<li><p>Draw dispersion parameter: <span class="math notranslate nohighlight">\(r_g \sim \text{Gamma}(\alpha_r, \beta_r)\)</span>
or <span class="math notranslate nohighlight">\(r_g \sim \text{LogNormal}(\mu_r, \sigma_r)\)</span></p></li>
<li><p>Draw dropout probability: <span class="math notranslate nohighlight">\(\pi_g \sim \text{Beta}(\alpha_{\pi}, \beta_{\pi})\)</span></p></li>
</ul>
</li>
<li><p>For each cell <span class="math notranslate nohighlight">\(c = 1,\ldots,N\)</span>:</p>
<ul>
<li><p>Draw capture probability: <span class="math notranslate nohighlight">\(\nu^{(c)} \sim \text{Beta}(\alpha_{\nu}, \beta_{\nu})\)</span></p></li>
<li><p>Compute effective probability: <span class="math notranslate nohighlight">\(\hat{p}^{(c)} = \frac{p \nu^{(c)}}{1 - p (1 - \nu^{(c)})}\)</span></p></li>
<li><p>For each gene <span class="math notranslate nohighlight">\(g = 1,\ldots,G\)</span>:</p>
<blockquote>
<div><ul class="simple">
<li><p>Draw dropout indicator: <span class="math notranslate nohighlight">\(z_g^{(c)} \sim \text{Bernoulli}(\pi_g)\)</span></p></li>
<li><p>If <span class="math notranslate nohighlight">\(z_g^{(c)} = 1\)</span>: set <span class="math notranslate nohighlight">\(u_g^{(c)} = 0\)</span></p></li>
<li><p>If <span class="math notranslate nohighlight">\(z_g^{(c)} = 0\)</span>: draw <span class="math notranslate nohighlight">\(u_g^{(c)} \sim \text{NegativeBinomial}(r_g, \hat{p}^{(c)})\)</span></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</li>
</ol>
</section>
<section id="id7">
<h3>Model Derivation<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<p>The ZINBVCP model combines the derivations of the NBVCP and ZINB models.
Starting with the standard negative binomial model for mRNA counts as shown in
Eq. (16), we then model both the capture process and technical dropouts:</p>
<div class="math notranslate nohighlight">
\[u_g^{(c)} \mid m_g^{(c)}, z_g^{(c)} \sim
z_g^{(c)} \delta_0 + (1-z_g^{(c)}) \text{Binomial}(m_g^{(c)}, \nu^{(c)})
\tag{19}\]</div>
<p>where <span class="math notranslate nohighlight">\(z_g^{(c)} \sim \text{Bernoulli}(\pi_g)\)</span>. Marginalizing over the
unobserved mRNA counts <span class="math notranslate nohighlight">\(m_g^{(c)}\)</span> and dropout indicators
<span class="math notranslate nohighlight">\(z_g^{(c)}\)</span>, we get:</p>
<div class="math notranslate nohighlight">
\[u_g^{(c)} \sim
\pi_g \delta_0 + (1-\pi_g)\text{NegativeBinomial}(r_g, \hat{p}^{(c)})
\tag{20}\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{p}^{(c)}\)</span> is the effective probability defined in Eq. (15) and
<span class="math notranslate nohighlight">\(\delta_0\)</span> is the Dirac delta function at zero.</p>
</section>
</section>
<section id="model-implementations-and-prior-distributions">
<h2>Model Implementations and Prior Distributions<a class="headerlink" href="#model-implementations-and-prior-distributions" title="Link to this heading"></a></h2>
<p>All models are implemented using variational inference with the following common
prior distributions:</p>
<p>For the success probability <span class="math notranslate nohighlight">\(p\)</span>:</p>
<div class="math notranslate nohighlight">
\[p \sim \text{Beta}(\alpha_p, \beta_p)
\tag{21}\]</div>
<p>Default values: <span class="math notranslate nohighlight">\(\alpha_p = \beta_p = 1\)</span> (uniform prior)</p>
<p>For each gene’s dispersion parameter <span class="math notranslate nohighlight">\(r_j\)</span>:</p>
<div class="math notranslate nohighlight">
\[r_j \sim \text{Gamma}(\alpha_r, \beta_r)
\tag{22}\]</div>
<p>Default values: <span class="math notranslate nohighlight">\(\alpha_r = 2\)</span>, <span class="math notranslate nohighlight">\(\beta_r = 0.1\)</span></p>
<p>Additional priors for model variants:</p>
<p>For each gene’s dropout probability (ZINB and ZINBVCP models):</p>
<div class="math notranslate nohighlight">
\[\pi_g \sim \text{Beta}(\alpha_{\pi}, \beta_{\pi})
\tag{23}\]</div>
<p>Default values: <span class="math notranslate nohighlight">\(\alpha_{\pi} = \beta_{\pi} = 1\)</span> (uniform prior)</p>
<p>For each cell’s capture probability (NBVCP and ZINBVCP models):</p>
<div class="math notranslate nohighlight">
\[\nu^{(c)} \sim \text{Beta}(\alpha_{\nu}, \beta_{\nu})
\tag{24}\]</div>
<p>Default values: <span class="math notranslate nohighlight">\(\alpha_{\nu} = \beta_{\nu} = 1\)</span> (uniform prior)</p>
</section>
<section id="variational-inference">
<h2>Variational Inference<a class="headerlink" href="#variational-inference" title="Link to this heading"></a></h2>
<p>All models use stochastic variational inference with a mean-field variational
family as the approximate posterior. The variational distributions match the
form of the priors:</p>
<p>For the success probability <span class="math notranslate nohighlight">\(p\)</span>:</p>
<div class="math notranslate nohighlight">
\[q(p) = \text{Beta}(\hat{\alpha}_p, \hat{\beta}_p)
\tag{25}\]</div>
<p>For each gene’s dispersion parameter <span class="math notranslate nohighlight">\(r_g\)</span>:</p>
<div class="math notranslate nohighlight">
\[q(r_g) = \text{Gamma}(\hat{\alpha}_{r,g}, \hat{\beta}_{r,g}) \quad \text{if using Gamma prior}
\tag{26.1}\]</div>
<div class="math notranslate nohighlight">
\[q(r_g) = \text{LogNormal}(\hat{\mu}_{r,g}, \hat{\sigma}_{r,g}) \quad \text{if using LogNormal prior}
\tag{26.2}\]</div>
<p>For each gene’s dropout probability (ZINB and ZINBVCP models):</p>
<div class="math notranslate nohighlight">
\[q(\pi_g) = \text{Beta}(\hat{\alpha}_{\pi,g}, \hat{\beta}_{\pi,g})
\tag{27}\]</div>
<p>For each cell’s capture probability (NBVCP and ZINBVCP models):</p>
<div class="math notranslate nohighlight">
\[q(\nu^{(c)}) = \text{Beta}(\hat{\alpha}_{\nu}^{(c)}, \hat{\beta}_{\nu}^{(c)})
\tag{28}\]</div>
<p>where hatted parameters are learnable variational parameters.</p>
<p>The Evidence Lower Bound (ELBO) is optimized for each model:</p>
<div class="math notranslate nohighlight">
\[\mathcal{L} = \langle \log \pi(\text{data}, \text{parameters}) \rangle_q -
\langle \log q(\text{parameters}) \rangle_q
\tag{29}\]</div>
<p>Learning uses the Adam optimizer with automatic differentiation through the
NumPyro framework.</p>
</section>
<section id="model-comparison-and-selection">
<h2>Model Comparison and Selection<a class="headerlink" href="#model-comparison-and-selection" title="Link to this heading"></a></h2>
<p>The following table summarizes the key differences between SCRIBE’s models:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Model</p></th>
<th class="head"><p>Zero-Inflation</p></th>
<th class="head"><p>Variable Capture</p></th>
<th class="head"><p>Additional Parameters</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NBDM</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>ZINB</p></td>
<td><p>Yes (gene-specific)</p></td>
<td><p>No</p></td>
<td><p>Dropout probabilities</p></td>
</tr>
<tr class="row-even"><td><p>NBVCP</p></td>
<td><p>No</p></td>
<td><p>Yes (cell-specific)</p></td>
<td><p>Capture probabilities</p></td>
</tr>
<tr class="row-odd"><td><p>ZINBVCP</p></td>
<td><p>Yes (gene-specific)</p></td>
<td><p>Yes (cell-specific)</p></td>
<td><p>Both</p></td>
</tr>
</tbody>
</table>
<p>Which model to choose:</p>
<ol class="arabic simple">
<li><p><strong>NBDM</strong>: Use as a baseline when data quality is good and technical variation
is minimal.</p></li>
<li><p><strong>ZINB</strong>: Choose when dropout is a dominant feature (many excess zeros) but
total counts are relatively consistent.</p></li>
<li><p><strong>NBVCP</strong>: Appropriate when cell-to-cell variation in total UMI counts is
high, suggesting variable capture efficiency.</p></li>
<li><p><strong>ZINBVCP</strong>: The most comprehensive model, handling both dropouts and capture
variation. Start with simpler models and progress to this if needed.</p></li>
</ol>
<p>You can use SCRIBE’s model comparison utilities to formally compare models:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scribe.model_comparison</span><span class="w"> </span><span class="kn">import</span> <span class="n">compare_models</span>

<span class="c1"># Fit multiple models</span>
<span class="n">nbdm_results</span> <span class="o">=</span> <span class="n">scribe</span><span class="o">.</span><span class="n">run_scribe</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">zero_inflated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">variable_capture</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">zinb_results</span> <span class="o">=</span> <span class="n">scribe</span><span class="o">.</span><span class="n">run_scribe</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">zero_inflated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">variable_capture</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Compare models using WAIC</span>
<span class="n">comparison</span> <span class="o">=</span> <span class="n">compare_models</span><span class="p">([</span><span class="n">nbdm_results</span><span class="p">,</span> <span class="n">zinb_results</span><span class="p">],</span> <span class="n">counts</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="implementation-details">
<h2>Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading"></a></h2>
<p>All models are implemented using:</p>
<ul class="simple">
<li><p>The <a class="reference external" href="https://num.pyro.ai/en/stable/index.html">NumPyro</a> probabilistic
programming framework</p></li>
<li><p><a class="reference external" href="https://jax.readthedocs.io/en/latest/">JAX</a> for automatic differentiation
and GPU acceleration</p></li>
<li><p>Stochastic variational inference with mini-batching for scalability</p></li>
<li><p>Mean-field variational families for approximate posteriors</p></li>
</ul>
</section>
<section id="model-assumptions">
<h2>Model Assumptions<a class="headerlink" href="#model-assumptions" title="Link to this heading"></a></h2>
<p>Common assumptions across all models:</p>
<ul class="simple">
<li><p>Overdispersion in molecular counts can be captured by negative binomial
distributions</p></li>
<li><p>Gene-specific dispersion parameters capture biological variation</p></li>
<li><p>The base success probability represents true biological probability of success</p></li>
</ul>
<p>Additional assumptions for specific models:</p>
<ul class="simple">
<li><p><strong>ZINB model</strong>: Zeros arise from two distinct processes - technical dropouts
and biological absence</p></li>
<li><p><strong>NBVCP model</strong>: Variation in total UMI counts partially reflects technical
capture differences</p></li>
<li><p><strong>ZINBVCP model</strong>: Both zero-inflation and capture efficiency variation are
present</p></li>
</ul>
</section>
<section id="usage-considerations">
<h2>Usage Considerations<a class="headerlink" href="#usage-considerations" title="Link to this heading"></a></h2>
<section id="nbdm-model">
<h3>NBDM Model<a class="headerlink" href="#nbdm-model" title="Link to this heading"></a></h3>
<p>The model is particularly suitable when:</p>
<ul class="simple">
<li><p>The data exhibits overdispersion relative to a Poisson model</p></li>
<li><p>The total count per cell varies moderately</p></li>
<li><p>Gene-specific variation needs to be captured</p></li>
</ul>
<p>It may be less suitable when:</p>
<ul class="simple">
<li><p>Zero-inflation is a dominant feature (consider ZINB model instead)</p></li>
<li><p>Cell-specific capture efficiencies vary significantly (consider NBVCP model)</p></li>
<li><p>The data contains multiple distinct cell populations (consider mixture models)</p></li>
</ul>
</section>
<section id="zinb-model">
<h3>ZINB Model<a class="headerlink" href="#zinb-model" title="Link to this heading"></a></h3>
<p>The ZINB model is particularly suitable when:</p>
<ul class="simple">
<li><p>The data exhibits excessive zeros beyond what a negative binomial predicts</p></li>
<li><p>You need to distinguish technical dropouts from biological zeros</p></li>
<li><p>Genes can be reasonably modeled independently</p></li>
</ul>
<p>It may be less suitable when:</p>
<ul class="simple">
<li><p>Library size variation is a major concern (consider NBVCP model)</p></li>
<li><p>Cell-specific capture efficiencies vary significantly (consider ZINBVCP model)</p></li>
<li><p>The data contains multiple distinct cell populations (consider mixture models)</p></li>
</ul>
</section>
<section id="nbvcp-model">
<h3>NBVCP Model<a class="headerlink" href="#nbvcp-model" title="Link to this heading"></a></h3>
<p>The NBVCP model is particularly suitable when:</p>
<ul class="simple">
<li><p>Cells show high variability in total UMI counts</p></li>
<li><p>Technical variation in capture efficiency is suspected</p></li>
<li><p>Library size normalization alone seems insufficient</p></li>
</ul>
<p>It may be less suitable when:</p>
<ul class="simple">
<li><p>Zero-inflation is a dominant feature (consider ZINBVCP model)</p></li>
<li><p>Capture efficiency variations are minimal</p></li>
<li><p>The data contains multiple distinct cell populations (consider mixture models)</p></li>
</ul>
</section>
<section id="zinbvcp-model">
<h3>ZINBVCP Model<a class="headerlink" href="#zinbvcp-model" title="Link to this heading"></a></h3>
<p>The ZINBVCP model is particularly suitable when:</p>
<ul class="simple">
<li><p>The data exhibits excessive zeros beyond what a negative binomial predicts</p></li>
<li><p>Cells show high variability in total UMI counts</p></li>
<li><p>Both technical dropouts and capture efficiency variation are suspected</p></li>
<li><p>Standard library size normalization seems insufficient</p></li>
</ul>
<p>It may be less suitable when:</p>
<ul class="simple">
<li><p>The data is relatively clean with few technical artifacts</p></li>
<li><p>The zero-inflation or capture efficiency variation is minimal</p></li>
<li><p>The data contains multiple distinct cell populations (consider mixture models)</p></li>
</ul>
<p>The model provides the most comprehensive treatment of technical artifacts among
the non-mixture models in SCRIBE, accounting for both dropouts and capture
efficiency variation. However, this flexibility comes at the cost of increased
model complexity and computational demands.</p>
</section>
</section>
<section id="recommended-model-selection-workflow">
<h2>Recommended Model Selection Workflow<a class="headerlink" href="#recommended-model-selection-workflow" title="Link to this heading"></a></h2>
<p>We recommend the following workflow for model selection:</p>
<ol class="arabic simple">
<li><p><strong>Start simple</strong>: Begin with the NBDM model as a baseline.</p></li>
<li><p><strong>Evaluate data characteristics</strong>:
- If there’s a large number of zeros, try the ZINB model
- If total UMI counts vary widely across cells, try the NBVCP model
- If both issues are present, try the ZINBVCP model</p></li>
<li><p><strong>Compare models formally</strong>:
- Use the <cite>compare_models</cite> function to compute WAIC scores
- Examine parameter estimates and their interpretation
- Consider computational requirements</p></li>
<li><p><strong>Consider biological interpretability</strong>:
- Does the selected model align with prior knowledge?
- Are the estimated parameters biologically plausible?</p></li>
<li><p><strong>Check for multiple populations</strong>:
- If heterogeneity persists, consider mixture variants (see next section)</p></li>
</ol>
</section>
<section id="mixture-model-extensions">
<h2>Mixture Model Extensions<a class="headerlink" href="#mixture-model-extensions" title="Link to this heading"></a></h2>
<p>Each model discussed above can be extended to include multiple components for
modeling heterogeneous cell populations. See the <a class="reference internal" href="models_mix.html"><span class="doc">Mixture Models</span></a> documentation
for details on mixture model variants.</p>
<p>The key idea is that cell populations with distinct expression profiles can be
modeled as separate components, each with their own parameters. Mixture models
have additional parameters:</p>
<ul class="simple">
<li><p>Mixing weights: <span class="math notranslate nohighlight">\(w_k \sim \text{Dirichlet}(\alpha_{\text{mix}})\)</span> for
each component <span class="math notranslate nohighlight">\(k\)</span></p></li>
<li><p>Component-specific dispersion parameters: <span class="math notranslate nohighlight">\(r_{g,k}\)</span> for each gene
<span class="math notranslate nohighlight">\(g\)</span> in component <span class="math notranslate nohighlight">\(k\)</span></p></li>
<li><p>Component-specific dropout probabilities: <span class="math notranslate nohighlight">\(\pi_{g,k}\)</span> (for models with
zero-inflation)</p></li>
</ul>
<p>The cell-specific capture probabilities <span class="math notranslate nohighlight">\(\nu^{(c)}\)</span> remain shared across
components in the mixture models.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<p>For more details on the mathematical foundations and evaluation of these models,
please refer to our paper: [CITATION].</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Manuel Razo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>